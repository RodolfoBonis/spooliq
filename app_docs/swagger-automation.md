# Swagger Documentation Automation

This project includes automatic Swagger/OpenAPI documentation generation using Git hooks and automated scripts.

## üîÑ How It Works

### Automatic Generation

Swagger documentation is automatically generated on every commit through a **pre-commit hook** that:

1. ‚úÖ Detects Swagger annotations in Go code
2. ‚úÖ Generates updated documentation files
3. ‚úÖ Adds generated files to the current commit
4. ‚úÖ Keeps documentation always synchronized with code

### Generated Files

```
docs/
‚îú‚îÄ‚îÄ docs.go         # Embedded Go documentation
‚îú‚îÄ‚îÄ swagger.json    # OpenAPI specification in JSON  
‚îî‚îÄ‚îÄ swagger.yaml    # OpenAPI specification in YAML
```

## üöÄ Initial Setup

### 1. Setup Hooks (New Projects)

```bash
# Run once after cloning/creating the project
bash scripts/setup-git-hooks.sh
```

This command:
- ‚úÖ Initializes Git repository if necessary
- ‚úÖ Installs pre-commit hook
- ‚úÖ Configures automatic documentation generation

### 2. Verify Configuration

```bash
# Check if hook is active
ls -la .git/hooks/pre-commit

# Test manual generation
bash scripts/generate-swagger.sh
```

## üìù Using Swagger Annotations

### Handler Example

```go
// GetSystemStatus returns current system information
// @Summary Get System Status  
// @Description Returns detailed system metrics including CPU, memory, GPU, and storage
// @Tags System
// @Accept json
// @Produce json
// @Success 200 {object} entities.SystemStatus
// @Failure 400 {object} errors.HTTPError
// @Failure 500 {object} errors.HTTPError
// @Router /v1/system [get]
func GetSystemStatusHandler(c *gin.Context) {
    // ... implementation
}
```

### Struct Example

```go
// SystemStatus represents the overall system status
type SystemStatus struct {
    OS      string `json:"OS" example:"Linux Ubuntu 20.04"`      
    CPU     CPU    `json:"CPU"`
    Memory  Memory `json:"Memory"`
    GPU     GPU    `json:"GPU"`
    Storage Storage `json:"Storage"`
    Server  Server `json:"Server"`
} // @name SystemStatus
```

### Error Response Example

```go
// HTTPError represents a standard HTTP error response
type HTTPError struct {
    Code    int    `json:"code" example:"400"`
    Message string `json:"message" example:"Bad Request"`
    Details string `json:"details,omitempty" example:"Invalid parameter format"`
} // @name HTTPError
```

## üîß Available Scripts

### Manual Generation

```bash
# Generate documentation manually
bash scripts/generate-swagger.sh

# Generate and add to Git
bash scripts/generate-swagger.sh --add-to-git
```

### Hook Configuration

```bash
# Install/reinstall hooks
bash scripts/setup-git-hooks.sh

# Check hook status
ls -la .git/hooks/
```

## üåê Accessing Documentation

### During Development

```bash
# Start application
make run

# Access interactive documentation
open http://localhost:8080/v1/docs/
```

### In Production

Documentation is available at the `/v1/docs/` endpoint of the application:

- **Swagger UI**: `http://your-api-host/v1/docs/`
- **OpenAPI JSON**: `http://your-api-host/v1/docs/swagger.json`
- **OpenAPI YAML**: `http://your-api-host/v1/docs/swagger.yaml`

## üõ†Ô∏è Technical Implementation

### Pre-commit Hook

The hook runs automatically before each commit:

```bash
#!/bin/bash
# Generate Swagger documentation using Docker
bash scripts/generate-swagger.sh --add-to-git

# Add generated files to commit
git add docs/
```

### Generation Script

The `generate-swagger.sh` uses:

1. **Local Swag** (if available) or **Docker** as fallback
2. **golang:1.23.6-alpine container** for isolated environment
3. **Static analysis** of Go code to extract annotations
4. **Automatic validation** of OpenAPI syntax

### Docker Integration

During Docker build, documentation is already generated and embedded:

```dockerfile
# Documentation already generated by pre-commit
COPY docs/ ./docs/

# Automatically served by the server
```

## üéØ Benefits

- ‚úÖ **Always up-to-date documentation**: Automatically synchronized with code
- ‚úÖ **Zero manual configuration**: Automatic hook after initial setup  
- ‚úÖ **Isolated environment**: Generation via Docker for consistency
- ‚úÖ **Multiple formats**: JSON, YAML and interactive UI
- ‚úÖ **Complete integration**: Embedded in application and CI/CD

## üîç Troubleshooting

### Hook doesn't execute

```bash
# Check permissions
chmod +x .git/hooks/pre-commit

# Reinstall hook
bash scripts/setup-git-hooks.sh
```

### Generation error

```bash
# Check Swagger annotations
bash scripts/generate-swagger.sh

# See detailed logs
docker run --rm -v "$(pwd):/workspace" -w /workspace golang:1.23.6-alpine \
  sh -c "go install github.com/swaggo/swag/cmd/swag@latest && swag init"
```

### Documentation doesn't appear

```bash
# Check if files were generated
ls -la docs/

# Check if they're in Git
git status docs/

# Regenerate if necessary
bash scripts/generate-swagger.sh --add-to-git
```

## üìö References

- [Swag Documentation](https://github.com/swaggo/swag)
- [OpenAPI Specification](https://swagger.io/specification/)
- [Swagger UI](https://swagger.io/tools/swagger-ui/) 